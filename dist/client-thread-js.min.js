/*! client-thread-js 22-03-2015 */
var thlibVersion = "1.1.0-alpha";
function threadJs(a){this.info="Version: "+thlibVersion+" by Matheus Silva matheus@mugfoundation.com";for(var b=0;b<arguments.length;b++)switch(arguments[b]){case"no-queue-overrides":this.noQueueOverrides=!0;break;default:this.noOptions=!0}return this.maxThreads=a||!1,this.ranThreads=[],this.queue=[],this.runningThreads=[],this.debugInfo=[],this.spawnEventWrapper=new Event("ThreadReady"),this.stop=!1,this}var thlibVersion="1.1.0-alpha";threadJs.prototype.getDebugInfo=function(){var a=debugInfo,b=new Blob([a]),c=window.URL.createObjectURL(b),d=document.createElement("div");d.id="debugDiv",d.style.display="none",document.body.appendChild(d),document.getElementById("debugDiv").innerHTML='<a href="'+c+'" download="debugInfo.log" id="dbui">dl</a>',document.getElementById("dbui").click()},threadJs.prototype.logDebugInfo=function(a){var b=0;this.debugInfo[b]=a,b++},threadJs.prototype.handler=function(){var a=this.queue[0][2];this.maxThreads===!1?(this.runningThreads[a]=new Worker(window.URL.createObjectURL(this.queue[0][0])),copyThreadInfo(a),this.queue.splice(0,1),this.dispatchEvent(this.spawnEventWrapper)):this.runningThreads.length<=this.maxThreads?(this.runningThreads[a]=new Worker(window.URL.createObjectURL(this.queue[0][0])),copyThreadInfo(a),this.queue.splice(0,1),this.dispatchEvent(this.spawnEventWrapper)):this.logDebugInfo("Thread limit exeded on: "+a),mcc>this.queue.length&&(this.stop=!0)},threadJs.prototype.endWorker=function(){this.runningThreads.terminate()},threadJs.prototype.copyThreadInfo=function(a){this.ranThreads[a]=this.queue[0]},threadJs.prototype.spawner=function(a,b,c){this.lastPidInQueue=this.queue.length-1;var d=this.getBlob(a,c);if(b<this.lastPidInQueue&&this.noQueueOverride===!1||b>=this.lastPidInQueue)this.queue[b]=d;else if(this.noQueueOverride===!0){for(;b<this.lastPidInQueue;)b++;b>this.queue.length&&(this.queue[b]=d)}},threadJs.prototype.getBlob=function(a,b){b=b||"text/javascript";var c=new Blob([a],b);return this.item[0]=c,this.item[1]=priority,this.item[2]=this.lastPidInQueue+1,this.item[3]=!1,this.item},threadJs.prototype.startParser=function(){for(this.stop===!0&&(this.stop=!1);this.stop===!1||this.queue<=0;)this.handler()},threadJs.prototype.stopParser=function(){this.stop=!0},threadJs.prototype.spawnByDownload=function(a){this.requestWrapper=new XMLHttpRequest,this.requestWrapper.onreadystatechange=this.doOn(),this.requestWrapper.open("GET",a,!0),this.requestWrapper.send(null)},threadJs.prototype.doOn=function(){4===this.requestWrapper.readyState&&(200===this.requestWrapper.status?this.spawner(this.requestWrapper.responseText):errCallback(this.requestWrapper.status))};